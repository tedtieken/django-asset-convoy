This code works but, man some of it is ugly.